{"ast":null,"code":"var _jsxFileName = \"/Users/rhead/Coding/campswim/dashboard/dashboard-ncompass/src/pages/failed-processes/failed-processes.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect, useRef } from 'react';\nimport { Redirect, useLocation } from 'react-router-dom';\nimport apiCall from '../../hooks/api-call';\nimport Unprocessed from './unprocessed';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst FailedProcesses = () => {\n  _s();\n  var _loggedInUser$restric;\n  const [failedProcesses, setFailedProcesses] = useState([]);\n  const [isLoaded, setIsLoaded] = useState(false);\n  const [error, setError] = useState(null);\n  const [loggedIn, setloggedIn] = useState(localStorage.getItem('loggedIn') ? parseInt(localStorage.getItem('loggedIn')) : 0);\n  const [loggedInUser, setLoggedInUser] = useState(localStorage.getItem('user') ? JSON.parse(localStorage.getItem('user')) : null);\n  const [currentTab, setCurrentTab] = useState(null);\n  const restrictedActions = useRef(loggedInUser === null || loggedInUser === void 0 ? void 0 : (_loggedInUser$restric = loggedInUser.restrictions) === null || _loggedInUser$restric === void 0 ? void 0 : _loggedInUser$restric.actions);\n\n  // Get the state values passed on the user's clicking of a redirect link.\n  const params = useLocation();\n  const state = params === null || params === void 0 ? void 0 : params.state;\n  let job, action, orderNum;\n  if (state) ({\n    job,\n    action,\n    orderNum\n  } = state);\n\n  // Handle the user choosing another tab on this page.\n  const handleClick = callerId => {\n    if (callerId === currentTab) {\n      setCurrentTab(null);\n      // setIsLoaded(false);\n    } else setCurrentTab(callerId);\n  };\n\n  // Get the unprocessed jobs from the DB.\n  useEffect(() => {\n    let mounted = true;\n    if (mounted) {\n      const operation = 'getAllProcessingErrors';\n      const query = `query ${operation} {${operation} {Id Name OrderNumber LineNumber Category ExternalSystem DataDirection At Message Exception AdditionalData DismissedAt DismissedBy}}`;\n      const variables = {};\n      apiCall(operation, query, variables).then(res => {\n        if (res.data) {\n          setFailedProcesses(res.data.getAllProcessingErrors);\n          setError(null);\n          setIsLoaded(true);\n        } else if (res.name) {\n          setError({\n            code: res.name,\n            message: res.message\n          });\n          setIsLoaded(true);\n        }\n      }, err => {\n        setError(err.response.data.errors);\n        setIsLoaded(false);\n      });\n    }\n    return () => mounted = false;\n  }, [currentTab]);\n\n  // Set the loggedIn variable.\n  useEffect(() => {\n    let mounted = true;\n    if (mounted) {\n      setloggedIn(localStorage.getItem('loggedIn') ? parseInt(localStorage.getItem('loggedIn')) : 0);\n      setLoggedInUser(localStorage.getItem('user') ? JSON.parse(localStorage.getItem('user')) : null);\n    }\n    return () => mounted = false;\n  }, []);\n  return !loggedIn ?\n  /*#__PURE__*/\n  // <div className=\"signin-error\">You must sign in to access this resource.</div>\n  _jsxDEV(Redirect, {\n    to: {\n      pathname: '/login',\n      state: {\n        action: 'Sign In',\n        message: 'Please sign in.'\n      }\n    }\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 72,\n    columnNumber: 5\n  }, this) : error ? /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"signin-error\",\n    children: error === null || error === void 0 ? void 0 : error.message\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 85,\n    columnNumber: 5\n  }, this) : loggedInUser && (loggedInUser.restrictions.pages === 'None' || !loggedInUser.restrictions.pages.includes('Failed Processes')) ? /*#__PURE__*/_jsxDEV(Unprocessed, {\n    jobs: failedProcesses,\n    error: error,\n    isLoaded: isLoaded,\n    handleClick: handleClick,\n    activeTab: currentTab ? currentTab : job ? job : null,\n    restrictedActions: restrictedActions.current,\n    order: orderNum,\n    action: action\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 91,\n    columnNumber: 7\n  }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"role-denied\",\n    children: [\"Your profile's assigned role of \\\"\", loggedInUser.role, \"\\\" does not allow you to access this page.\"]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 103,\n    columnNumber: 7\n  }, this);\n};\n_s(FailedProcesses, \"Yr8JSC1fWxqCvmbTyrYXvy12s7Q=\", false, function () {\n  return [useLocation];\n});\n_c = FailedProcesses;\nexport default FailedProcesses;\nvar _c;\n$RefreshReg$(_c, \"FailedProcesses\");","map":{"version":3,"names":["React","useState","useEffect","useRef","Redirect","useLocation","apiCall","Unprocessed","jsxDEV","_jsxDEV","FailedProcesses","_s","_loggedInUser$restric","failedProcesses","setFailedProcesses","isLoaded","setIsLoaded","error","setError","loggedIn","setloggedIn","localStorage","getItem","parseInt","loggedInUser","setLoggedInUser","JSON","parse","currentTab","setCurrentTab","restrictedActions","restrictions","actions","params","state","job","action","orderNum","handleClick","callerId","mounted","operation","query","variables","then","res","data","getAllProcessingErrors","name","code","message","err","response","errors","to","pathname","fileName","_jsxFileName","lineNumber","columnNumber","className","children","pages","includes","jobs","activeTab","current","order","role","_c","$RefreshReg$"],"sources":["/Users/rhead/Coding/campswim/dashboard/dashboard-ncompass/src/pages/failed-processes/failed-processes.js"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\nimport { Redirect, useLocation } from 'react-router-dom';\nimport apiCall from '../../hooks/api-call';\nimport Unprocessed from './unprocessed';\n\nconst FailedProcesses = () => {\n  const [failedProcesses, setFailedProcesses] = useState([]);\n  const [isLoaded, setIsLoaded] = useState(false);\n  const [error, setError] = useState(null);\n  const [loggedIn, setloggedIn] = useState(localStorage.getItem('loggedIn') ? parseInt(localStorage.getItem('loggedIn')) : 0);\n  const [loggedInUser, setLoggedInUser] = useState(localStorage.getItem('user') ? JSON.parse(localStorage.getItem('user')) : null);\n  const [currentTab, setCurrentTab] = useState(null);\n  const restrictedActions = useRef(loggedInUser?.restrictions?.actions);\n\n  // Get the state values passed on the user's clicking of a redirect link.\n  const params = useLocation();\n  const state = params?.state;\n  let job, action, orderNum;  \n  if (state) ({ job, action, orderNum } = state);\n\n  // Handle the user choosing another tab on this page.\n  const handleClick = (callerId) => {\n    if (callerId === currentTab) {\n      setCurrentTab(null);\n      // setIsLoaded(false);\n    } else setCurrentTab(callerId);\n  }\n\n  // Get the unprocessed jobs from the DB.\n  useEffect(() => {\n    let mounted = true;\n    if (mounted) {\n      const operation = 'getAllProcessingErrors';\n      const query = `query ${operation} {${operation} {Id Name OrderNumber LineNumber Category ExternalSystem DataDirection At Message Exception AdditionalData DismissedAt DismissedBy}}`;\n      const variables = {};\n      \n      apiCall(operation, query, variables)\n      .then(\n        res => {\n          if (res.data) {\n            setFailedProcesses(res.data.getAllProcessingErrors);\n            setError(null);\n            setIsLoaded(true);\n          } else if (res.name) {\n            setError({code: res.name, message: res.message});\n            setIsLoaded(true);\n          }\n        },\n        err => {\n          setError(err.response.data.errors);\n          setIsLoaded(false);\n        }\n      );\n    }\n    \n    return () => mounted = false;\n  }, [currentTab]);\n\n  // Set the loggedIn variable.\n  useEffect(() => {\n    let mounted = true;\n    if (mounted) {\n      setloggedIn(localStorage.getItem('loggedIn') ? parseInt(localStorage.getItem('loggedIn')) : 0);\n      setLoggedInUser(localStorage.getItem('user') ? JSON.parse(localStorage.getItem('user')) : null);\n    }\n    return () => mounted = false;\n  }, []);\n  \n  return !loggedIn ?\n  (\n    // <div className=\"signin-error\">You must sign in to access this resource.</div>\n    <Redirect to={\n        {\n          pathname: '/login',\n          state: {\n            action: 'Sign In',\n            message: 'Please sign in.'\n          },\n        }\n      }\n    />\n  )\n  : error ?\n  (\n    <div className=\"signin-error\">{error?.message}</div>\n  )\n  :\n  (\n    loggedInUser && (loggedInUser.restrictions.pages === 'None' || !loggedInUser.restrictions.pages.includes('Failed Processes')) ?\n    (\n      <Unprocessed \n        jobs={failedProcesses} \n        error={error} \n        isLoaded={isLoaded} \n        handleClick={handleClick} \n        activeTab={currentTab ? currentTab : job ? job : null} restrictedActions={restrictedActions.current} \n        order={orderNum} \n        action={action} \n      />\n    )\n    :\n    (\n      <div className=\"role-denied\">Your profile's assigned role of \"{loggedInUser.role}\" does not allow you to access this page.</div>\n    )\n  )\n};\n\nexport default FailedProcesses;\n"],"mappings":";;AAAA,OAAOA,KAAK,IAAIC,QAAQ,EAAEC,SAAS,EAAEC,MAAM,QAAQ,OAAO;AAC1D,SAASC,QAAQ,EAAEC,WAAW,QAAQ,kBAAkB;AACxD,OAAOC,OAAO,MAAM,sBAAsB;AAC1C,OAAOC,WAAW,MAAM,eAAe;AAAC,SAAAC,MAAA,IAAAC,OAAA;AAExC,MAAMC,eAAe,GAAGA,CAAA,KAAM;EAAAC,EAAA;EAAA,IAAAC,qBAAA;EAC5B,MAAM,CAACC,eAAe,EAAEC,kBAAkB,CAAC,GAAGb,QAAQ,CAAC,EAAE,CAAC;EAC1D,MAAM,CAACc,QAAQ,EAAEC,WAAW,CAAC,GAAGf,QAAQ,CAAC,KAAK,CAAC;EAC/C,MAAM,CAACgB,KAAK,EAAEC,QAAQ,CAAC,GAAGjB,QAAQ,CAAC,IAAI,CAAC;EACxC,MAAM,CAACkB,QAAQ,EAAEC,WAAW,CAAC,GAAGnB,QAAQ,CAACoB,YAAY,CAACC,OAAO,CAAC,UAAU,CAAC,GAAGC,QAAQ,CAACF,YAAY,CAACC,OAAO,CAAC,UAAU,CAAC,CAAC,GAAG,CAAC,CAAC;EAC3H,MAAM,CAACE,YAAY,EAAEC,eAAe,CAAC,GAAGxB,QAAQ,CAACoB,YAAY,CAACC,OAAO,CAAC,MAAM,CAAC,GAAGI,IAAI,CAACC,KAAK,CAACN,YAAY,CAACC,OAAO,CAAC,MAAM,CAAC,CAAC,GAAG,IAAI,CAAC;EAChI,MAAM,CAACM,UAAU,EAAEC,aAAa,CAAC,GAAG5B,QAAQ,CAAC,IAAI,CAAC;EAClD,MAAM6B,iBAAiB,GAAG3B,MAAM,CAACqB,YAAY,aAAZA,YAAY,wBAAAZ,qBAAA,GAAZY,YAAY,CAAEO,YAAY,cAAAnB,qBAAA,uBAA1BA,qBAAA,CAA4BoB,OAAO,CAAC;;EAErE;EACA,MAAMC,MAAM,GAAG5B,WAAW,CAAC,CAAC;EAC5B,MAAM6B,KAAK,GAAGD,MAAM,aAANA,MAAM,uBAANA,MAAM,CAAEC,KAAK;EAC3B,IAAIC,GAAG,EAAEC,MAAM,EAAEC,QAAQ;EACzB,IAAIH,KAAK,EAAE,CAAC;IAAEC,GAAG;IAAEC,MAAM;IAAEC;EAAS,CAAC,GAAGH,KAAK;;EAE7C;EACA,MAAMI,WAAW,GAAIC,QAAQ,IAAK;IAChC,IAAIA,QAAQ,KAAKX,UAAU,EAAE;MAC3BC,aAAa,CAAC,IAAI,CAAC;MACnB;IACF,CAAC,MAAMA,aAAa,CAACU,QAAQ,CAAC;EAChC,CAAC;;EAED;EACArC,SAAS,CAAC,MAAM;IACd,IAAIsC,OAAO,GAAG,IAAI;IAClB,IAAIA,OAAO,EAAE;MACX,MAAMC,SAAS,GAAG,wBAAwB;MAC1C,MAAMC,KAAK,GAAI,SAAQD,SAAU,KAAIA,SAAU,sIAAqI;MACpL,MAAME,SAAS,GAAG,CAAC,CAAC;MAEpBrC,OAAO,CAACmC,SAAS,EAAEC,KAAK,EAAEC,SAAS,CAAC,CACnCC,IAAI,CACHC,GAAG,IAAI;QACL,IAAIA,GAAG,CAACC,IAAI,EAAE;UACZhC,kBAAkB,CAAC+B,GAAG,CAACC,IAAI,CAACC,sBAAsB,CAAC;UACnD7B,QAAQ,CAAC,IAAI,CAAC;UACdF,WAAW,CAAC,IAAI,CAAC;QACnB,CAAC,MAAM,IAAI6B,GAAG,CAACG,IAAI,EAAE;UACnB9B,QAAQ,CAAC;YAAC+B,IAAI,EAAEJ,GAAG,CAACG,IAAI;YAAEE,OAAO,EAAEL,GAAG,CAACK;UAAO,CAAC,CAAC;UAChDlC,WAAW,CAAC,IAAI,CAAC;QACnB;MACF,CAAC,EACDmC,GAAG,IAAI;QACLjC,QAAQ,CAACiC,GAAG,CAACC,QAAQ,CAACN,IAAI,CAACO,MAAM,CAAC;QAClCrC,WAAW,CAAC,KAAK,CAAC;MACpB,CACF,CAAC;IACH;IAEA,OAAO,MAAMwB,OAAO,GAAG,KAAK;EAC9B,CAAC,EAAE,CAACZ,UAAU,CAAC,CAAC;;EAEhB;EACA1B,SAAS,CAAC,MAAM;IACd,IAAIsC,OAAO,GAAG,IAAI;IAClB,IAAIA,OAAO,EAAE;MACXpB,WAAW,CAACC,YAAY,CAACC,OAAO,CAAC,UAAU,CAAC,GAAGC,QAAQ,CAACF,YAAY,CAACC,OAAO,CAAC,UAAU,CAAC,CAAC,GAAG,CAAC,CAAC;MAC9FG,eAAe,CAACJ,YAAY,CAACC,OAAO,CAAC,MAAM,CAAC,GAAGI,IAAI,CAACC,KAAK,CAACN,YAAY,CAACC,OAAO,CAAC,MAAM,CAAC,CAAC,GAAG,IAAI,CAAC;IACjG;IACA,OAAO,MAAMkB,OAAO,GAAG,KAAK;EAC9B,CAAC,EAAE,EAAE,CAAC;EAEN,OAAO,CAACrB,QAAQ;EAAA;EAEd;EACAV,OAAA,CAACL,QAAQ;IAACkD,EAAE,EACR;MACEC,QAAQ,EAAE,QAAQ;MAClBrB,KAAK,EAAE;QACLE,MAAM,EAAE,SAAS;QACjBc,OAAO,EAAE;MACX;IACF;EACD;IAAAM,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OACF,CAAC,GAEF1C,KAAK,gBAELR,OAAA;IAAKmD,SAAS,EAAC,cAAc;IAAAC,QAAA,EAAE5C,KAAK,aAALA,KAAK,uBAALA,KAAK,CAAEiC;EAAO;IAAAM,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OAAM,CAAC,GAIpDnC,YAAY,KAAKA,YAAY,CAACO,YAAY,CAAC+B,KAAK,KAAK,MAAM,IAAI,CAACtC,YAAY,CAACO,YAAY,CAAC+B,KAAK,CAACC,QAAQ,CAAC,kBAAkB,CAAC,CAAC,gBAE3HtD,OAAA,CAACF,WAAW;IACVyD,IAAI,EAAEnD,eAAgB;IACtBI,KAAK,EAAEA,KAAM;IACbF,QAAQ,EAAEA,QAAS;IACnBuB,WAAW,EAAEA,WAAY;IACzB2B,SAAS,EAAErC,UAAU,GAAGA,UAAU,GAAGO,GAAG,GAAGA,GAAG,GAAG,IAAK;IAACL,iBAAiB,EAAEA,iBAAiB,CAACoC,OAAQ;IACpGC,KAAK,EAAE9B,QAAS;IAChBD,MAAM,EAAEA;EAAO;IAAAoB,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OAChB,CAAC,gBAIFlD,OAAA;IAAKmD,SAAS,EAAC,aAAa;IAAAC,QAAA,GAAC,oCAAiC,EAACrC,YAAY,CAAC4C,IAAI,EAAC,4CAAyC;EAAA;IAAAZ,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OAAK,CAElI;AACH,CAAC;AAAChD,EAAA,CApGID,eAAe;EAAA,QAUJL,WAAW;AAAA;AAAAgE,EAAA,GAVtB3D,eAAe;AAsGrB,eAAeA,eAAe;AAAC,IAAA2D,EAAA;AAAAC,YAAA,CAAAD,EAAA"},"metadata":{},"sourceType":"module","externalDependencies":[]}