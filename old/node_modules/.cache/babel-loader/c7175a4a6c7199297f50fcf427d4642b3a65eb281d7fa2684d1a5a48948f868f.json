{"ast":null,"code":"var _jsxFileName = \"/Users/rhead/Coding/campswim/dashboard/dashboard-ncompass/src/pages/login/signin.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect, useRef } from 'react';\nimport { Redirect } from 'react-router-dom';\nimport User from '../../hooks/get-user';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst Signin = ({\n  profile,\n  message,\n  liftData,\n  liftUser,\n  signUp\n}) => {\n  _s();\n  var _userInfo$current, _userInfo$current2, _userInfo$current3, _userInfo$current4, _userInfo$current5, _userInfo$current6;\n  const [username, setUsername] = useState(profile && profile.email ? profile.email : '');\n  const [password, setPassword] = useState(profile && profile.password ? profile.password : '');\n  const [confirmPassword, setConfirmPassword] = useState('');\n  const [id, setId] = useState('');\n  const [name, setName] = useState([]);\n  const [role, setRole] = useState(profile === null || profile === void 0 ? void 0 : profile.role);\n  const [roleName, setRoleName] = useState(null);\n  const [roles, setRoles] = useState([]);\n  const [successMessage, setSuccessMessage] = useState('');\n  const [error, setError] = useState('');\n  const [loggedIn, setLoggedIn] = useState(0);\n  const [renderSignUp, setRenderSignUp] = useState(signUp);\n  const [changePassword, setChangePassword] = useState(false);\n  const [buttonText, setButtonText] = useState('Sign In');\n  const userAction = useRef(profile === null || profile === void 0 ? void 0 : profile.action);\n  const userInfo = useRef(null);\n  const user = new User();\n\n  // Handle the clicking of the sign-in button.\n  const handleSignIn = event => {\n    event.preventDefault();\n    document.getElementById('sign-in-button').innerText = 'Signing in . . . ';\n    userAction.current = 'Sign In';\n    user.email = username;\n    setError(null);\n    if (!changePassword) {\n      // See if the user already exists in the db.\n      user.getUserByEmail().then(res => {\n        if (res.data) {\n          var _res$data, _res$data$userByEmail;\n          const id = (_res$data = res.data) === null || _res$data === void 0 ? void 0 : (_res$data$userByEmail = _res$data.userByEmail) === null || _res$data$userByEmail === void 0 ? void 0 : _res$data$userByEmail.Id;\n          if (id) {\n            var _res$data2, _res$data2$userByEmai, _res$data3, _res$data3$userByEmai;\n            // We have a user.\n            const activeUser = (_res$data2 = res.data) === null || _res$data2 === void 0 ? void 0 : (_res$data2$userByEmai = _res$data2.userByEmail) === null || _res$data2$userByEmai === void 0 ? void 0 : _res$data2$userByEmai.Active;\n            const firstSignin = (_res$data3 = res.data) === null || _res$data3 === void 0 ? void 0 : (_res$data3$userByEmai = _res$data3.userByEmail) === null || _res$data3$userByEmai === void 0 ? void 0 : _res$data3$userByEmai.LastLogin;\n            user.id = id;\n            user.password = password;\n            if (!activeUser) {\n              // The user has been deactivated and should not be given access to the site.\n              setError('This user profile has been deactivated.\\nContact your supervisor to gain access to this resource.');\n              document.getElementById('sign-in-button').innerText = 'Sign In';\n            } else {\n              // The user is active.\n              if (!firstSignin) {\n                // Make the user change her password.\n                user.changePassword(true).then(\n                // arg => firstSignin\n                res => {\n                  if (res) {\n                    var _res$data4, _res$data4$changePass, _res$data5, _res$data5$changePass;\n                    const id = res === null || res === void 0 ? void 0 : (_res$data4 = res.data) === null || _res$data4 === void 0 ? void 0 : (_res$data4$changePass = _res$data4.changePassword) === null || _res$data4$changePass === void 0 ? void 0 : _res$data4$changePass.Id;\n                    const error = res === null || res === void 0 ? void 0 : (_res$data5 = res.data) === null || _res$data5 === void 0 ? void 0 : (_res$data5$changePass = _res$data5.changePassword) === null || _res$data5$changePass === void 0 ? void 0 : _res$data5$changePass.Error;\n                    if (id && !error) {\n                      const signInButton = document.getElementById('sign-in-button');\n                      setChangePassword(true);\n                      document.getElementById('new-password-first-field').focus();\n                      if (signInButton) signInButton.innerText = 'Update';\n                      setError('');\n                      setId(id);\n                      setPassword('');\n                      setConfirmPassword('');\n                    } else if (error) setError(error);\n                  } else if (res.name) {\n                    // There was an error.\n                    setError(res.message);\n                  }\n                }, err => {\n                  console.error(err);\n                });\n              } else {\n                // Make the API call to validate the user and generate/sign her token.\n                user.signIn().then(res => {\n                  if (res.data) {\n                    var _res$data6;\n                    const userData = (_res$data6 = res.data) === null || _res$data6 === void 0 ? void 0 : _res$data6.signin;\n                    const error = userData === null || userData === void 0 ? void 0 : userData.Error;\n                    setId(id);\n                    if (error) {\n                      // Print the error and reset the sign-in button's text.\n                      setError(error);\n                      document.getElementById('sign-in-button').innerText = 'Sign In';\n                    } else {\n                      if (userData) {\n                        // Get user restrictions from the db and add them to the user object in local storage.\n                        user.getUserRestrictions(userData.RoleId).then(res => {\n                          if (res) {\n                            var _res$data7;\n                            const roleProfile = res === null || res === void 0 ? void 0 : (_res$data7 = res.data) === null || _res$data7 === void 0 ? void 0 : _res$data7.getUserRestrictions;\n                            const error = roleProfile === null || roleProfile === void 0 ? void 0 : roleProfile.Error;\n                            if (!error) {\n                              // Build the user object to be stored in the browser.\n                              const userObject = {\n                                id: userData.Id,\n                                name: userData.Name,\n                                role: userData.Role,\n                                roleId: userData.RoleId,\n                                restrictions: {\n                                  pages: roleProfile.RestrictedPages,\n                                  actions: roleProfile.RestrictedActions\n                                }\n                              };\n                              localStorage.setItem('user', JSON.stringify(userObject));\n                              userInfo.current = userObject;\n                              liftData(!error ? true : false, 'signin', false, 103);\n                              liftUser(userObject);\n                              setLoggedIn(!error ? 1 : 0);\n                              setRenderSignUp(false);\n                            } else setError(error);\n                          }\n                        }, err => {\n                          setError(err);\n                          console.error(err);\n                        });\n                      } else {\n                        if (res.errors) {\n                          const errorsArray = [];\n                          res.errors.forEach(err => {\n                            const errorMessage = err.message;\n                            errorsArray.push(errorMessage);\n                          });\n                          if (errorsArray.length > 0) setError(errorsArray);\n                        }\n                      }\n                    }\n                  } else if (res.name) {\n                    setError(res.message);\n                  }\n                }, err => {\n                  console.error({\n                    err\n                  });\n                });\n              }\n            }\n          } else {\n            // The user needs to be registered (or they entered an incorrect email address).\n            // If there are no users at all in the database, render the signup page.\n            user.getAllUsersSansToken().then(res => {\n              if (res.data) {\n                var _res$data8, _res$data9;\n                const id = (_res$data8 = res.data) === null || _res$data8 === void 0 ? void 0 : _res$data8.users[0].Id;\n                const error = (_res$data9 = res.data) === null || _res$data9 === void 0 ? void 0 : _res$data9.users[0].Error;\n                if (!id && !error) {\n                  setRenderSignUp(true);\n                  userAction.current = 'Add User';\n                } else if (id && !error) {\n                  setError('There is no user associated with this email address.\\n\\nPlease ensure you\\'ve entered the correct email address or ask the site\\'s administrator for access.');\n                  liftData(false, 'signin', true); // Args => boolean, caller, error (boolean).\n                  document.getElementById('sign-in-button').innerText = 'Sign in';\n                  document.getElementById('sign-in-button').classList.remove('reset-color');\n                }\n              } else if (res.name) {\n                setError(res.message);\n              }\n            }, err => {\n              console.error({\n                err\n              });\n            });\n          }\n        } else {\n          if (!res.response) {\n            setError('Network error. Check that the API is up and running');\n            document.getElementById('sign-in-button').innerText = 'Sign In';\n          }\n        }\n      }, err => {\n        console.error({\n          err\n        });\n      });\n    } else {\n      // Update the user's password.\n      if (confirmPassword !== password) {\n        // Ensure that the user has entered her password correctly.\n        setError('The passwords do not match; please re-enter them.');\n        setPassword('');\n        setConfirmPassword('');\n        const signInButton = document.getElementById('sign-in-button');\n        document.getElementById('new-password-first-field').focus();\n        if (signInButton) signInButton.innerText = 'Update';\n      } else {\n        // The passwords match, so send it to the db and sign the user in.\n        setError(null);\n        user.id = id;\n        user.password = confirmPassword;\n        user.changePassword(false).then(\n        // The return on this call to changePassword is the same as for signin.\n        res => {\n          if (res.data) {\n            var _res$data10;\n            const userData = (_res$data10 = res.data) === null || _res$data10 === void 0 ? void 0 : _res$data10.changePassword;\n            const id = userData === null || userData === void 0 ? void 0 : userData.Id;\n            const error = userData === null || userData === void 0 ? void 0 : userData.Error;\n\n            // If id, the user's password has been updated and the user has been logged in, so redirect to the dashboard.\n            if (id && !error) {\n              setId(id);\n\n              // Get user restrictions from the db and add them to the user object in local storage.\n              user.getUserRestrictions(userData.RoleId).then(res => {\n                if (res) {\n                  var _res$data11;\n                  const roleProfile = res === null || res === void 0 ? void 0 : (_res$data11 = res.data) === null || _res$data11 === void 0 ? void 0 : _res$data11.getUserRestrictions;\n                  const error = roleProfile === null || roleProfile === void 0 ? void 0 : roleProfile.Error;\n                  if (!error) {\n                    // Build the user object to be stored in the browser.\n                    const userObject = {\n                      id: userData.Id,\n                      name: userData.Name,\n                      role: userData.Role,\n                      roleId: userData.RoleId,\n                      restrictions: {\n                        pages: roleProfile.RestrictedPages,\n                        actions: roleProfile.RestrictedActions\n                      }\n                    };\n                    localStorage.setItem('user', JSON.stringify(userObject));\n                    userInfo.current = userObject;\n                    liftData(!error ? true : false, 'signin', false);\n                    liftUser(userData);\n                    setLoggedIn(1);\n                    setError(null);\n                    setChangePassword(false);\n                  } else {\n                    setError(error);\n                    setLoggedIn(0);\n                  }\n                }\n              }, err => {\n                console.error(err);\n                setError(err);\n              });\n            }\n          }\n        }, err => {\n          console.error(err);\n          setError(err);\n        });\n      }\n    }\n  };\n\n  // Handle the clicking of the sign-up button.\n  const handleSignUp = event => {\n    event.preventDefault();\n    document.getElementById('register-button').textContent = 'Registering . . .';\n    user.email = username;\n    user.password = password;\n    user.name = name;\n    user.role = role ? role : '';\n    user.role = !isNaN(parseInt(user.role)) ? parseInt(user.role) : user.role;\n    setError(null);\n    if (role) {\n      user.signUp().then(res => {\n        if (res.data) {\n          var _res$data12, _res$data12$signup, _res$data$signup;\n          if ((_res$data12 = res.data) !== null && _res$data12 !== void 0 && (_res$data12$signup = _res$data12.signup) !== null && _res$data12$signup !== void 0 && _res$data12$signup.Error) {\n            var _res$data13, _res$data13$signup;\n            setError((_res$data13 = res.data) === null || _res$data13 === void 0 ? void 0 : (_res$data13$signup = _res$data13.signup) === null || _res$data13$signup === void 0 ? void 0 : _res$data13$signup.Error);\n            setLoggedIn(0);\n            document.getElementById('register-button').textContent = 'Register';\n          } else if ((_res$data$signup = res.data.signup) !== null && _res$data$signup !== void 0 && _res$data$signup.Id) {\n            var _res$data14, _res$data14$signup, _res$data15, _res$data15$signup;\n            setSuccessMessage((_res$data14 = res.data) === null || _res$data14 === void 0 ? void 0 : (_res$data14$signup = _res$data14.signup) === null || _res$data14$signup === void 0 ? void 0 : _res$data14$signup.Message);\n            setError(null);\n            setId((_res$data15 = res.data) === null || _res$data15 === void 0 ? void 0 : (_res$data15$signup = _res$data15.signup) === null || _res$data15$signup === void 0 ? void 0 : _res$data15$signup.Id);\n            userAction.current = 'Sign In';\n          }\n        } else if (res.name) {\n          setError(res.message);\n        }\n        if (res.errors) res.errors.forEach(error => console.error({\n          error\n        })); // For debugging.\n      }, err => {\n        console.error({\n          err\n        });\n      });\n    } else setError('Please select a role for this user.');\n  };\n\n  // Toggle the roles' dropdown menu on click.\n  const toggleSelect = () => {\n    const options = document.getElementById('select-role').children;\n    if (options) {\n      Object.values(options).forEach(option => {\n        if (option.id) {\n          if (!option.id.includes('default')) option.classList.toggle('show-option');else option.classList.toggle('fade-default');\n        }\n      });\n    }\n    setRoleName(null);\n    setRole(null);\n  };\n\n  // Open the roles' dropdown menu on focus.\n  const openDropdown = () => {\n    const options = document.getElementById('select-role').children;\n    if (options) {\n      Object.values(options).forEach(option => {\n        if (option.id) {\n          if (!option.id.includes('default')) {\n            option.classList.add('show-option');\n          } else {\n            option.classList.add('fade-default');\n          }\n        }\n      });\n    }\n  };\n\n  // Toggle the class that highlights the role.\n  const toggleClass = event => {\n    const options = document.getElementById('select-role').children;\n    const id = event.target.id;\n    setRoleName(null);\n    setRole(null);\n    if (options) {\n      for (let option of options) {\n        if (!option.id.includes('default')) {\n          if (option.id !== id) {\n            document.getElementById(option.id).classList.remove('highlight-option');\n          } else {\n            document.getElementById(id).classList.add('highlight-option');\n          }\n        }\n      }\n    }\n  };\n\n  // Capture the user's role.\n  const handleSelect = event => {\n    const roleId = event.target.dataset.value;\n    const roleName = event.target.textContent;\n    const options = document.getElementById('select-role').children;\n    if (options) {\n      Object.values(options).forEach(option => {\n        if (option.id) {\n          if (!option.id.includes('default')) {\n            option.classList.remove('show-option');\n          } else {\n            option.classList.remove('fade-default');\n            option.classList.add('role-selected');\n          }\n        }\n      });\n    }\n    setRole(roleId);\n    setRoleName(roleName);\n  };\n\n  // Render the sign-up form.\n  useEffect(() => {\n    let mounted = true;\n    if (mounted) {\n      if (userAction.current === 'Add User' && profile.action === 'Add User') setRenderSignUp(true);else setRenderSignUp(false);\n    }\n    return () => mounted = false;\n  }, [profile.action]);\n\n  // Change the page's nav title.\n  useEffect(() => {\n    let mounted = true;\n    if (mounted) {\n      if (userAction.current === 'Add User' && profile.action === 'Add User') {\n        liftData(true, 'signup', false);\n        setRenderSignUp(true);\n      } else if (profile.action === 'Sign Out' && userAction.current === 'Sign Out') {\n        const user = new User();\n        user.signOut().then(res => {\n          if (res) {\n            if (res.data) {\n              setLoggedIn(0);\n              userAction.current = 'Sign In';\n              liftData(false, 'signin', false);\n              setError(null);\n              setRenderSignUp(false);\n              liftUser(null);\n              localStorage.setItem('user', null);\n            } else if (res.name) {\n              // console.error(res.message);\n            }\n          }\n        }, err => {\n          console.error({\n            err\n          });\n        });\n      }\n    }\n    return () => mounted = false;\n  }, [liftData, liftUser, profile.action]);\n\n  // Get the user's available roles for sign-up.\n  useEffect(() => {\n    let mounted = true;\n    if (mounted) {\n      const user = new User(); // Must create a new user inside the useEffect, otherwise the code runs ad nauseum.\n      user.getUserRoles().then(res => {\n        if (res.data) {\n          var _res$data16;\n          const userRoles = (_res$data16 = res.data) === null || _res$data16 === void 0 ? void 0 : _res$data16.getUserRoles;\n          setRoles(userRoles);\n        } else if (res.name) {\n          setError(res.message);\n        }\n      }, err => {\n        console.error({\n          err\n        });\n      });\n    }\n    return () => mounted = false;\n  }, []);\n  return !renderSignUp && !changePassword ?\n  /*#__PURE__*/\n  // Sign in.\n  _jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"signin-container\",\n      children: [/*#__PURE__*/_jsxDEV(\"p\", {\n        children: message\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 425,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"form\", {\n        onSubmit: e => handleSignIn(e),\n        children: [/*#__PURE__*/_jsxDEV(\"input\", {\n          name: \"username\",\n          value: username,\n          placeholder: \"Email\",\n          onChange: e => setUsername(e.target.value),\n          required: true\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 427,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          name: \"password\",\n          value: password,\n          placeholder: \"Password\",\n          onChange: e => setPassword(e.target.value),\n          required: true,\n          type: \"password\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 428,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          name: \"submit\",\n          type: \"submit\",\n          children: buttonText\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 430,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 426,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 424,\n      columnNumber: 7\n    }, this), error ? /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"sign-in-error\",\n      children: error\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 434,\n      columnNumber: 9\n    }, this) : parseInt(loggedIn) && userInfo.current ? /*#__PURE__*/_jsxDEV(Redirect, {\n      to: {\n        pathname: '/dashboard',\n        state: {\n          user: {\n            id: (_userInfo$current = userInfo.current) === null || _userInfo$current === void 0 ? void 0 : _userInfo$current.Id,\n            name: (_userInfo$current2 = userInfo.current) === null || _userInfo$current2 === void 0 ? void 0 : _userInfo$current2.Name,\n            role: (_userInfo$current3 = userInfo.current) === null || _userInfo$current3 === void 0 ? void 0 : _userInfo$current3.Role,\n            action: 'Dashboard'\n          }\n        }\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 436,\n      columnNumber: 9\n    }, this) : '']\n  }, void 0, true) : !renderSignUp && changePassword ?\n  /*#__PURE__*/\n  // Change password.\n  _jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"signin-container\",\n      children: [/*#__PURE__*/_jsxDEV(\"p\", {\n        children: \"Enter a new password and confirm it in the second field.\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 455,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"form\", {\n        onSubmit: e => handleSignIn(e),\n        children: [/*#__PURE__*/_jsxDEV(\"input\", {\n          id: \"new-password-first-field\",\n          name: \"password\",\n          value: password,\n          placeholder: \"Enter your new password.\",\n          onChange: e => setPassword(e.target.value),\n          type: \"password\",\n          required: true\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 457,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          name: \"password\",\n          value: confirmPassword,\n          placeholder: \"Re-enter your new password.\",\n          onChange: e => setConfirmPassword(e.target.value),\n          required: true,\n          type: \"password\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 458,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          id: \"sign-in-button\",\n          name: \"submit\",\n          type: \"submit\",\n          children: \"Update\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 459,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 456,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 454,\n      columnNumber: 7\n    }, this), error ? /*#__PURE__*/_jsxDEV(\"div\", {\n      children: error\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 463,\n      columnNumber: 9\n    }, this) : parseInt(loggedIn) && userInfo.current ? /*#__PURE__*/_jsxDEV(Redirect, {\n      to: {\n        pathname: '/dashboard',\n        state: {\n          user: {\n            id: (_userInfo$current4 = userInfo.current) === null || _userInfo$current4 === void 0 ? void 0 : _userInfo$current4.Id,\n            name: (_userInfo$current5 = userInfo.current) === null || _userInfo$current5 === void 0 ? void 0 : _userInfo$current5.Name,\n            role: (_userInfo$current6 = userInfo.current) === null || _userInfo$current6 === void 0 ? void 0 : _userInfo$current6.Role\n          }\n        }\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 465,\n      columnNumber: 9\n    }, this) : '']\n  }, void 0, true) :\n  /*#__PURE__*/\n  // Sign up.\n  _jsxDEV(\"div\", {\n    className: \"signup-container\",\n    children: !id ? /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: [/*#__PURE__*/_jsxDEV(\"form\", {\n        onSubmit: handleSignUp,\n        children: [/*#__PURE__*/_jsxDEV(\"input\", {\n          name: \"your-name\",\n          value: name,\n          placeholder: \"Name\",\n          onChange: e => setName(e.target.value),\n          required: true\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 486,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          name: \"email\",\n          value: username,\n          placeholder: \"Email\",\n          onChange: e => setUsername(e.target.value),\n          required: true\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 487,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"select-container add-user\",\n          id: \"select-role\",\n          name: \"role\",\n          onChange: () => handleSelect(),\n          children: [/*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"role-option default\",\n            id: \"default\",\n            value: \"default\",\n            onClick: () => toggleSelect(),\n            onKeyUp: () => openDropdown(),\n            tabIndex: \"0\",\n            children: roleName ? roleName : 'Role'\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 489,\n            columnNumber: 15\n          }, this), roles.map((value, key) => /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"role-option\",\n            id: `option-${key}`,\n            \"data-value\": value.Id,\n            onClick: e => handleSelect(e),\n            onFocus: e => toggleClass(e, key),\n            onKeyPress: e => handleSelect(e),\n            tabIndex: \"0\",\n            children: value.Role\n          }, key, false, {\n            fileName: _jsxFileName,\n            lineNumber: 499,\n            columnNumber: 17\n          }, this))]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 488,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          name: \"password\",\n          value: password,\n          placeholder: \"Password\",\n          type: \"password\",\n          onChange: e => setPassword(e.target.value),\n          required: true\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 513,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          id: \"register-button\",\n          name: \"submit\",\n          type: \"submit\",\n          children: \"Register\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 514,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 485,\n        columnNumber: 11\n      }, this), error ? /*#__PURE__*/_jsxDEV(\"div\", {\n        children: error\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 518,\n        columnNumber: 13\n      }, this) : '']\n    }, void 0, true) : /*#__PURE__*/_jsxDEV(Redirect, {\n      to: {\n        pathname: '/users',\n        state: {\n          id,\n          action: 'Add User',\n          message: successMessage\n        }\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 524,\n      columnNumber: 9\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 481,\n    columnNumber: 5\n  }, this);\n};\n_s(Signin, \"ADSwR5wFXOweeGaZtots6IDx6CQ=\");\n_c = Signin;\nexport default Signin;\nvar _c;\n$RefreshReg$(_c, \"Signin\");","map":{"version":3,"names":["React","useState","useEffect","useRef","Redirect","User","jsxDEV","_jsxDEV","Fragment","_Fragment","Signin","profile","message","liftData","liftUser","signUp","_s","_userInfo$current","_userInfo$current2","_userInfo$current3","_userInfo$current4","_userInfo$current5","_userInfo$current6","username","setUsername","email","password","setPassword","confirmPassword","setConfirmPassword","id","setId","name","setName","role","setRole","roleName","setRoleName","roles","setRoles","successMessage","setSuccessMessage","error","setError","loggedIn","setLoggedIn","renderSignUp","setRenderSignUp","changePassword","setChangePassword","buttonText","setButtonText","userAction","action","userInfo","user","handleSignIn","event","preventDefault","document","getElementById","innerText","current","getUserByEmail","then","res","data","_res$data","_res$data$userByEmail","userByEmail","Id","_res$data2","_res$data2$userByEmai","_res$data3","_res$data3$userByEmai","activeUser","Active","firstSignin","LastLogin","_res$data4","_res$data4$changePass","_res$data5","_res$data5$changePass","Error","signInButton","focus","err","console","signIn","_res$data6","userData","signin","getUserRestrictions","RoleId","_res$data7","roleProfile","userObject","Name","Role","roleId","restrictions","pages","RestrictedPages","actions","RestrictedActions","localStorage","setItem","JSON","stringify","errors","errorsArray","forEach","errorMessage","push","length","getAllUsersSansToken","_res$data8","_res$data9","users","classList","remove","response","_res$data10","_res$data11","handleSignUp","textContent","isNaN","parseInt","_res$data12","_res$data12$signup","_res$data$signup","signup","_res$data13","_res$data13$signup","_res$data14","_res$data14$signup","_res$data15","_res$data15$signup","Message","toggleSelect","options","children","Object","values","option","includes","toggle","openDropdown","add","toggleClass","target","handleSelect","dataset","value","mounted","signOut","getUserRoles","_res$data16","userRoles","className","fileName","_jsxFileName","lineNumber","columnNumber","onSubmit","e","placeholder","onChange","required","type","to","pathname","state","onClick","onKeyUp","tabIndex","map","key","onFocus","onKeyPress","_c","$RefreshReg$"],"sources":["/Users/rhead/Coding/campswim/dashboard/dashboard-ncompass/src/pages/login/signin.js"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\nimport {  Redirect } from 'react-router-dom';\nimport User from '../../hooks/get-user';\n\nconst Signin = ({ profile, message, liftData, liftUser, signUp }) => {\n  const [username, setUsername] = useState(profile && profile.email ? profile.email : '');\n  const [password, setPassword] = useState(profile && profile.password ? profile.password : '');\n  const [confirmPassword, setConfirmPassword] = useState('');\n  const [id, setId] = useState('');\n  const [name, setName] = useState([]);\n  const [role, setRole] = useState(profile?.role);\n  const [roleName, setRoleName] = useState(null);\n  const [roles, setRoles] = useState([]);\n  const [successMessage, setSuccessMessage] = useState('');\n  const [error, setError] = useState('');\n  const [loggedIn, setLoggedIn] = useState(0);\n  const [renderSignUp, setRenderSignUp] = useState(signUp);\n  const [changePassword, setChangePassword] = useState(false);\n  const [buttonText, setButtonText] = useState('Sign In');\n  const userAction = useRef(profile?.action);\n  const userInfo = useRef(null);\n  const user = new User();\n\n  // Handle the clicking of the sign-in button.\n  const handleSignIn = event => {\n    event.preventDefault();\n    document.getElementById('sign-in-button').innerText = 'Signing in . . . ';\n    userAction.current = 'Sign In';\n    user.email = username;\n    setError(null);\n        \n    if (!changePassword) {\n      // See if the user already exists in the db.\n      user.getUserByEmail().then(\n        res => {          \n          if (res.data) {\n            const id = res.data?.userByEmail?.Id;\n            \n            if (id) { // We have a user.\n              const activeUser = res.data?.userByEmail?.Active;\n              const firstSignin = res.data?.userByEmail?.LastLogin;\n              user.id = id;\n              user.password = password;\n              \n              if (!activeUser) { // The user has been deactivated and should not be given access to the site.\n                setError('This user profile has been deactivated.\\nContact your supervisor to gain access to this resource.');\n                document.getElementById('sign-in-button').innerText = 'Sign In';\n              } else { // The user is active.\n                if (!firstSignin) { // Make the user change her password.\n                  user.changePassword(true).then(  // arg => firstSignin\n                    res => {\n                      if (res) {\n                        const id = res?.data?.changePassword?.Id;\n                        const error = res?.data?.changePassword?.Error;\n                        \n                        if (id && !error) {\n                          const signInButton = document.getElementById('sign-in-button');\n                          setChangePassword(true);\n                          document.getElementById('new-password-first-field').focus();\n\n                          if (signInButton) signInButton.innerText = 'Update';\n                          setError('');\n                          setId(id);\n                          setPassword('');\n                          setConfirmPassword('');\n                        } else if (error) setError(error);\n                      } else if (res.name) { // There was an error.\n                        setError(res.message);\n                      }\n                    },\n                    err => { console.error(err); }\n                  );\n                } else { // Make the API call to validate the user and generate/sign her token.\n                  user.signIn().then(\n                    res => {                      \n                      if (res.data) {\n                        const userData = res.data?.signin;\n                        const error = userData?.Error;\n                        setId(id);\n                        \n                        if (error) { // Print the error and reset the sign-in button's text.\n                          setError(error);\n                          document.getElementById('sign-in-button').innerText = 'Sign In';\n                        } else {\n                          if (userData) { // Get user restrictions from the db and add them to the user object in local storage.\n                            user.getUserRestrictions(userData.RoleId).then(\n                              res => {                                \n                                if (res) {\n                                  const roleProfile = res?.data?.getUserRestrictions;\n                                  const error = roleProfile?.Error;\n                                \n                                  if (!error) { // Build the user object to be stored in the browser.\n                                    const userObject = {\n                                      id: userData.Id,\n                                      name: userData.Name,\n                                      role: userData.Role,\n                                      roleId: userData.RoleId,\n                                      restrictions: {\n                                        pages: roleProfile.RestrictedPages,\n                                        actions: roleProfile.RestrictedActions\n                                      }\n                                    };\n                                            \n                                    localStorage.setItem('user', JSON.stringify(userObject));                                  \n                                    userInfo.current = userObject;\n                                    liftData(!error ? true : false, 'signin', false, 103);\n                                    liftUser(userObject);\n                                    setLoggedIn(!error ? 1 : 0);\n                                    setRenderSignUp(false);\n                \n                                  } else setError(error);\n                                }\n                              },\n                              err => {\n                                setError(err);\n                                console.error(err);\n                              }\n                            );\n                          } else {\n                            if (res.errors) {\n                              const errorsArray = [];\n\n                              res.errors.forEach(err => {\n                                const errorMessage = err.message;\n                                errorsArray.push(errorMessage);\n                              });\n\n                              if (errorsArray.length > 0) setError(errorsArray);\n                            }\n                          }\n                        }\n                      } else if (res.name) {\n                        setError(res.message);\n                      }\n                    },\n                    err => { console.error({err}) }\n                  );\n                }\n              }\n            } else { // The user needs to be registered (or they entered an incorrect email address).\n              // If there are no users at all in the database, render the signup page.\n              user.getAllUsersSansToken().then(\n                res => {\n                  if (res.data) {\n                    const id = res.data?.users[0].Id;\n                    const error = res.data?.users[0].Error;\n                    if (!id && !error) {\n                      setRenderSignUp(true);\n                      userAction.current = 'Add User';\n                    } else if (id && !error) {\n                      setError('There is no user associated with this email address.\\n\\nPlease ensure you\\'ve entered the correct email address or ask the site\\'s administrator for access.');                      \n                      liftData(false, 'signin', true); // Args => boolean, caller, error (boolean).\n                      document.getElementById('sign-in-button').innerText = 'Sign in';\n                      document.getElementById('sign-in-button').classList.remove('reset-color');\n                    }\n                  } else if (res.name) {\n                    setError(res.message);\n                  }\n                },\n                err => {\n                  console.error({err});\n                }\n              );\n            }\n          } else {\n            if (!res.response) {\n              setError('Network error. Check that the API is up and running');\n              document.getElementById('sign-in-button').innerText = 'Sign In';\n            }\n          }\n        },\n        err => { console.error({err}); }\n      );\n    } else { // Update the user's password.\n      if (confirmPassword !== password) { // Ensure that the user has entered her password correctly.\n        setError('The passwords do not match; please re-enter them.');\n        setPassword('');\n        setConfirmPassword('');\n        const signInButton = document.getElementById('sign-in-button');\n        document.getElementById('new-password-first-field').focus();\n        if (signInButton) signInButton.innerText = 'Update';\n      } else { // The passwords match, so send it to the db and sign the user in.\n        setError(null);\n        user.id = id;\n        user.password = confirmPassword;\n        user.changePassword(false).then(  // The return on this call to changePassword is the same as for signin.\n          res => {\n            if (res.data) {\n              const userData = res.data?.changePassword;\n              const id = userData?.Id;\n              const error = userData?.Error;\n\n              // If id, the user's password has been updated and the user has been logged in, so redirect to the dashboard.\n              if (id && !error) {\n                setId(id);\n\n                // Get user restrictions from the db and add them to the user object in local storage.\n                user.getUserRestrictions(userData.RoleId).then(\n                  res => {\n                    if (res) {\n                      const roleProfile = res?.data?.getUserRestrictions;\n                      const error = roleProfile?.Error;\n\n                      if (!error) { // Build the user object to be stored in the browser.\n                        const userObject = {\n                          id: userData.Id,\n                          name: userData.Name,\n                          role: userData.Role,\n                          roleId: userData.RoleId,\n                          restrictions: {\n                            pages: roleProfile.RestrictedPages,\n                            actions: roleProfile.RestrictedActions\n                          }\n                        };\n\n                        localStorage.setItem('user', JSON.stringify(userObject));\n                        userInfo.current = userObject;\n                        liftData(!error ? true : false, 'signin', false);\n                        liftUser(userData);\n                        setLoggedIn(1);\n                        setError(null);\n                        setChangePassword(false);\n                      } else {\n                        setError(error);\n                        setLoggedIn(0);\n                      }\n                    }\n                  },\n                  err => {\n                    console.error(err);\n                    setError(err);\n                  }\n                );\n              }\n            }\n          },\n          err => { \n            console.error(err);\n            setError(err);\n          }\n        );\n      }\n    }\n  };\n\n  // Handle the clicking of the sign-up button.\n  const handleSignUp = (event) => {\n    event.preventDefault();\n    document.getElementById('register-button').textContent = 'Registering . . .';\n    user.email = username;\n    user.password = password;\n    user.name = name;\n    user.role = role ? role : '';\n    user.role = !isNaN(parseInt(user.role)) ? parseInt(user.role) : user.role;\n    setError(null);\n\n    if (role) {\n      user.signUp().then(\n        res => {\n          if (res.data) {\n            if (res.data?.signup?.Error) {\n              setError(res.data?.signup?.Error);\n              setLoggedIn(0);\n              document.getElementById('register-button').textContent = 'Register';\n            } else if (res.data.signup?.Id) {\n              setSuccessMessage(res.data?.signup?.Message);\n              setError(null);\n              setId(res.data?.signup?.Id);\n              userAction.current = 'Sign In';\n            }\n          } else if (res.name) {\n            setError(res.message);\n          } \n          \n          if (res.errors) res.errors.forEach(error => console.error({error})); // For debugging.\n        },\n        err => { console.error({err}) }\n      );\n    } else setError('Please select a role for this user.');\n  }\n\n  // Toggle the roles' dropdown menu on click.\n  const toggleSelect = () => {\n    const options = document.getElementById('select-role').children;\n    if (options) {\n      Object.values(options).forEach(option => {\n        if (option.id) {\n          if (!option.id.includes('default')) option.classList.toggle('show-option');\n          else option.classList.toggle('fade-default');\n        }\n      });\n    }\n\n    setRoleName(null);\n    setRole(null);\n  };\n\n  // Open the roles' dropdown menu on focus.\n  const openDropdown = () => {\n    const options = document.getElementById('select-role').children;\n    \n    if (options) {\n      Object.values(options).forEach(option => {\n        if (option.id) {\n          if (!option.id.includes('default')) {\n            option.classList.add('show-option');\n          } else {\n            option.classList.add('fade-default')\n          }\n        }\n      });\n    }\n  };\n\n  // Toggle the class that highlights the role.\n  const toggleClass = (event) => {\n    const options = document.getElementById('select-role').children;\n    const id = event.target.id;\n\n    setRoleName(null);\n    setRole(null);\n\n    if (options) {\n      for (let option of options) {\n        if (!option.id.includes('default')) {\n          if (option.id !== id) {\n            document.getElementById(option.id).classList.remove('highlight-option');\n          } else {\n            document.getElementById(id).classList.add('highlight-option');\n          }\n        }\n      }\n    }\n  };\n\n  // Capture the user's role.\n  const handleSelect = (event) => {\n    const roleId = event.target.dataset.value;\n    const roleName = event.target.textContent;\n    const options = document.getElementById('select-role').children;\n\n    if (options) {\n      Object.values(options).forEach(option => {\n        if (option.id) {\n          if (!option.id.includes('default')) {\n            option.classList.remove('show-option');\n          } else {\n            option.classList.remove('fade-default')\n            option.classList.add('role-selected');\n          }\n        }\n      });\n    }\n\n    setRole(roleId);\n    setRoleName(roleName);\n  };\n\n  // Render the sign-up form.\n  useEffect(() => {\n    let mounted = true;\n    if (mounted) {\n      if (userAction.current === 'Add User' && profile.action === 'Add User') setRenderSignUp(true);\n      else setRenderSignUp(false);\n    }\n    return () => mounted = false;\n  }, [profile.action]);\n  \n  // Change the page's nav title.\n  useEffect(() => {\n    let mounted = true;\n    if (mounted) {\n      if (userAction.current === 'Add User' && profile.action === 'Add User') {\n        liftData(true, 'signup', false);\n        setRenderSignUp(true);\n      } else if (profile.action === 'Sign Out' && userAction.current === 'Sign Out') {\n        const user = new User();\n        user.signOut().then(\n          res => {\n            if (res) {\n              if (res.data) {\n                setLoggedIn(0);\n                userAction.current = 'Sign In';\n                liftData(false, 'signin', false);\n                setError(null);\n                setRenderSignUp(false);\n                liftUser(null);\n                localStorage.setItem('user', null)\n              } else if (res.name) {\n                // console.error(res.message);\n              }  \n            }\n          },\n          err => { console.error({err}) }\n        );  \n      }\n    }\n    return () => mounted = false;\n  }, [liftData, liftUser, profile.action]);\n\n  // Get the user's available roles for sign-up.\n  useEffect(() => {\n    let mounted = true;\n    if (mounted) {\n      const user = new User(); // Must create a new user inside the useEffect, otherwise the code runs ad nauseum.\n      user.getUserRoles().then(\n        res => {          \n          if (res.data) {\n            const userRoles = res.data?.getUserRoles;\n            setRoles(userRoles);\n          } else if (res.name) {\n            setError(res.message);\n          }\n        },\n        err => { console.error({err}); }\n      );\n    }\n    return () => mounted = false;\n  }, []);\n    \n  return !renderSignUp && !changePassword ?\n  ( // Sign in.\n    <> \n      <div className='signin-container'>\n        <p>{message}</p>\n        <form onSubmit={(e) => handleSignIn(e)}>\n          <input name='username' value={username} placeholder='Email' onChange={(e) => setUsername(e.target.value)} required />\n          <input name='password' value={password} placeholder='Password' onChange={(e) => setPassword(e.target.value)} required type='password'/>\n          {/* <button id='sign-in-button' name='submit' type='submit'>Sign In</button> */}\n          <button name='submit' type='submit'>{buttonText}</button>\n        </form>\n      </div>\n      {error ?\n        <div className='sign-in-error'>{error}</div>\n      : parseInt(loggedIn) && userInfo.current ?\n        <Redirect to={{\n          pathname: '/dashboard',\n          state: {\n            user: {\n              id: userInfo.current?.Id,\n              name: userInfo.current?.Name,\n              role: userInfo.current?.Role,\n              action: 'Dashboard'\n            }\n          }\n        }}\n        />\n      : ''}\n    </>\n  ) \n  : !renderSignUp && changePassword ? \n  ( // Change password.\n    <> \n      <div className='signin-container'>\n        <p>Enter a new password and confirm it in the second field.</p>\n        <form onSubmit={(e) => handleSignIn(e)}>\n          <input id='new-password-first-field' name='password' value={password} placeholder='Enter your new password.' onChange={(e) => setPassword(e.target.value)} type='password' required />\n          <input name='password' value={confirmPassword} placeholder='Re-enter your new password.' onChange={(e) => setConfirmPassword(e.target.value)} required type='password' />\n          <button id='sign-in-button' name='submit' type='submit'>Update</button>\n        </form>\n      </div>\n      {error ?\n        <div>{error}</div>\n      : parseInt(loggedIn) && userInfo.current ?\n        <Redirect to={{\n          pathname: '/dashboard',\n          state: {\n            user: {\n              id: userInfo.current?.Id,\n              name: userInfo.current?.Name,\n              role: userInfo.current?.Role\n            }\n          }\n        }}\n        />\n      : ''}\n    </>\n  ) \n  : \n  ( // Sign up.\n    <div className='signup-container'>\n      {!id ? \n      (\n        <>\n          <form onSubmit={handleSignUp}>\n            <input name='your-name' value={name} placeholder='Name' onChange={(e) => setName(e.target.value)} required />\n            <input name='email' value={username} placeholder='Email' onChange={(e) => setUsername(e.target.value)} required />\n            <div className='select-container add-user' id='select-role' name='role' onChange={() => handleSelect()}>\n              <p \n                className='role-option default' \n                id='default' value='default' \n                onClick={() => toggleSelect()}\n                onKeyUp={() => openDropdown()}\n                tabIndex='0'\n              >\n                {roleName ? roleName : 'Role'}\n              </p>\n              {roles.map((value, key) => (\n                <p \n                  className='role-option' \n                  id={`option-${key}`} \n                  key={key} \n                  data-value={value.Id} \n                  onClick={(e) => handleSelect(e)} \n                  onFocus={(e) => toggleClass(e, key)} \n                  onKeyPress={(e) => handleSelect(e)}\n                  tabIndex='0'\n                >\n                  {value.Role}\n                </p>\n              ))}\n            </div>\n            <input name='password' value={password} placeholder='Password' type='password' onChange={(e) => setPassword(e.target.value)} required />\n            <button id='register-button' name='submit' type='submit'>Register</button>\n          </form>\n          {error ? \n          (\n            <div>{error}</div>\n          ) : (\n            ''\n          )}\n        </>\n      ) : (\n        <Redirect to={\n          {\n            pathname: '/users',\n            state: {\n              id,\n              action: 'Add User',\n              message: successMessage\n            },\n          }\n        }\n        />\n      )}\n    </div>\n  )\n}\n\nexport default Signin;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}